# 概念
## 四元数
q = w + xi + yj + zk

w 是实部（标量部分）

x, y, z 是虚部（向量部分）

i, j, k 是四元数的基本单位

用于表示旋转的四元数必须是单位四元数（模长为1）：
|q| = √(w² + x² + y² + z²) = 1

旋转轴为 (x, y, z) 方向，旋转角度为 θ 的四元数表示为：
q = cos(θ/2) + sin(θ/2) * (xi + yj + zk)

## 四元数转欧拉角

### 数学公式

四元数 `q = [w, x, y, z]` 转换为欧拉角 `[roll, pitch, yaw]`：

**Roll (横滚角) - 绕X轴旋转：**
```
roll = atan2(2(wx + yz), 1 - 2(x² + y²))
```

**Pitch (俯仰角) - 绕Y轴旋转：**
```
pitch = asin(2(wy - zx))
```

**Yaw (偏航角) - 绕Z轴旋转：**
```
yaw = atan2(2(wz + xy), 1 - 2(y² + z²))
```

### C语言实现

```c
#include <math.h>

typedef struct {
    float w, x, y, z;
} quaternion_t;

typedef struct {
    float roll, pitch, yaw;  // 单位：弧度
} euler_t;

void quaternion_to_euler(const quaternion_t* q, euler_t* euler) {
    float w = q->w, x = q->x, y = q->y, z = q->z;
    
    // Roll (x轴旋转)
    euler->roll = atan2f(2.0f * (w * x + y * z), 
                         1.0f - 2.0f * (x * x + y * y));
    
    // Pitch (y轴旋转) - 防止万向锁
    float sinp = 2.0f * (w * y - z * x);
    if (fabsf(sinp) >= 1.0f) {
        euler->pitch = copysignf(M_PI / 2.0f, sinp);
    } else {
        euler->pitch = asinf(sinp);
    }
    
    // Yaw (z轴旋转)
    euler->yaw = atan2f(2.0f * (w * z + x * y), 
                        1.0f - 2.0f * (y * y + z * z));
}
```

### 注意事项

1. **输入四元数必须归一化**
2. **万向锁处理**：当 `|sin(pitch)| ≥ 1` 时会发生万向锁
3. **角度范围**：Roll/Yaw: [-π, π], Pitch: [-π/2, π/2]